---
title: "OTU analysis Cleaned"
author: "Alejandra"
date: "March 26, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
##load packages needed to split up the data
library(dplyr)
library(splitstackshape)
library(reshape)
Biotrap_full_data = read.csv("../Data/Organized-Data/Biotrap-OTU-data.csv")
Full_biotrap_dataframe = data.frame(Biotrap_full_data[c(4:35)])
##This has far too many observations to do an NMDS. We can reduce the number of
##observations by making a data frame based on a taxonomic rank Split up the
##dataframe by taxonomy by adding taxonomic ranks as columns
TaxSplit=cSplit(Full_biotrap_dataframe, "Taxonomy", ";")


names(TaxSplit)[32]="Kingdom"

names(TaxSplit)[33]="Phylum"

names(TaxSplit)[34]="Class"

names(TaxSplit)[35]="Order"

names(TaxSplit)[36]="Family"

names(TaxSplit)[37]="Genus"


##arrange by class since it is more descriptive than kingdom and might give
##insight into how the data is arranged
ClassesMelt=melt(TaxSplit, id.vars = "Class", measure.vars = c("LBT03","LBT04","LBT05","LBT07","LBT08","LBT09","LBT10","LBT89", "LBT90", "LBT91" ,"LBT92" , "LBT93","LBT94", "LBT96","LBT97","LBT98","LBTL10","LBTL7","LBTL9A","AxBT01" , "AxBT03", "AxBT05", "AxBT08", "AxBT10", "AxBT18", "AxBT36", "AxBT38", "AxBT43", "AxBT44", "AxBT47", "AxBT66")) 
##make it a data frame
ClassesMelt_df = data.frame(ClassesMelt)
##now rearrange to wide format using "reshape" function
ClassMelt_wide_df = reshape(ClassesMelt_df, idvar = "Class", timevar = "variable", direction = "wide")
##remove "class" variable to create a data frame for nmds
library(dplyr)
ClassMelt_OTU_df = select(ClassMelt_wide_df, -Class)
##Now we can perform an NMDS analysis
library(vegan)
OTU_count_nmds = metaMDS(ClassMelt_OTU_df)
##plot NMDS to visualize variation
NMDS_1 =plot(OTU_count_nmds)
nmds_pdf = pdf(NMDS_Classplot)

```


